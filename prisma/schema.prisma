generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model certifications {
  id                  BigInt                @id @default(autoincrement()) @db.UnsignedBigInt
  name                String                @unique(map: "name") @db.VarChar(255)
  created_at          DateTime              @default(now()) @db.Timestamp(0)
  updated_at          DateTime              @default(now()) @db.Timestamp(0)
  user_certifications user_certifications[]
}

model courses {
  id           BigInt         @id @default(autoincrement()) @db.UnsignedBigInt
  name         String         @unique(map: "name") @db.VarChar(255)
  created_at   DateTime       @default(now()) @db.Timestamp(0)
  updated_at   DateTime       @default(now()) @db.Timestamp(0)
  user_courses user_courses[]
}

model leagues {
  id              BigInt         @id @default(autoincrement()) @db.UnsignedBigInt
  name            String         @unique(map: "uq_league_name") @db.VarChar(150)
  president       String         @db.VarChar(150)
  is_professional Boolean        @default(false)
  logo_url        String?        @db.VarChar(500)
  created_at      DateTime       @default(now()) @db.Timestamp(0)
  updated_at      DateTime       @default(now()) @db.Timestamp(0)
  user_leagues    user_leagues[]
}

model medical_profiles {
  id                      BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  user_id                 BigInt   @unique(map: "uq_medical_user") @db.UnsignedBigInt
  blood_type              String?  @db.VarChar(3)
  allergies               String?  @db.VarChar(255)
  chronic_diseases        String?  @db.VarChar(255)
  medications             String?  @db.VarChar(255)
  emergency_contact_name  String?  @db.VarChar(120)
  emergency_contact_phone String?  @db.VarChar(40)
  created_at              DateTime @default(now()) @db.DateTime(0)
  updated_at              DateTime @default(now()) @db.DateTime(0)
  users                   users    @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_medical_user")
}

model medical_vaccines {
  id           BigInt                        @id @default(autoincrement()) @db.UnsignedBigInt
  user_id      BigInt                        @db.UnsignedBigInt
  vaccine_code medical_vaccines_vaccine_code
  vaccinated   Boolean                       @default(false)
  vaccine_date DateTime?                     @db.Date
  created_at   DateTime                      @default(now()) @db.DateTime(0)
  updated_at   DateTime                      @default(now()) @db.DateTime(0)
  users        users                         @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_vaccines_user")

  @@index([vaccine_code], map: "ix_vaccine_code")
  @@index([user_id], map: "ix_vaccine_user")
}

model personal_profiles {
  id                        BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  user_id                   BigInt    @unique(map: "uq_personal_user") @db.UnsignedBigInt
  photo                     String?   @db.VarChar(500)
  first_name                String    @db.VarChar(100)
  last_name                 String    @db.VarChar(100)
  gender                    String    @db.VarChar(10)
  id_letter                 String    @db.VarChar(2)
  id_number                 String    @db.VarChar(20)
  birthdate                 DateTime  @db.Date
  marital_status            String    @db.VarChar(30)
  couple_names              String?   @db.VarChar(150)
  couple_surnames           String?   @db.VarChar(150)
  couple_phone              String?   @db.VarChar(40)
  has_driver_license        Boolean   @default(false)
  driver_license_expiration DateTime? @db.Date
  first_line_descendants    String?   @db.VarChar(255)
  address                   String    @db.VarChar(255)
  current_state             String    @db.VarChar(100)
  birth_city                String    @db.VarChar(120)
  birth_state               String    @db.VarChar(120)
  phone                     String    @db.VarChar(40)

  // Email ahora vive aquí
  contact_email             String    @db.VarChar(255) @unique(map: "uq_personal_email")

  has_passport              Boolean   @default(false)
  passport_number           String?   @db.VarChar(30)
  passport_exp_date         DateTime? @db.Date
  has_visa                  Boolean   @default(false)
  visa_type                 String?   @db.VarChar(60)
  visa_exp_date             DateTime? @db.Date
  nearest_airport           String    @db.VarChar(120)
  education_level           String    @db.VarChar(120)
  specialism                String?   @db.VarChar(120)
  lang_english              Boolean   @default(false)
  lang_italian              Boolean   @default(false)
  lang_portuguese           Boolean   @default(false)
  bank_name                 String    @db.VarChar(120)
  bank_account_number       String    @db.VarChar(24)
  created_at                DateTime  @default(now()) @db.DateTime(0)
  updated_at                DateTime  @default(now()) @db.DateTime(0)

  users                     users     @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_personal_user")
}

model roles {
  id    Int     @id @default(autoincrement()) @db.UnsignedTinyInt
  name  String  @unique(map: "name") @db.VarChar(50)
  users users[]
}

model uniform_profiles {
  id               BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  user_id          BigInt   @unique(map: "uq_uniform_user") @db.UnsignedBigInt
  plate_pants_size String?  @db.VarChar(10)
  base_pants_size  String?  @db.VarChar(10)
  work_shirt_size  String?  @db.VarChar(10)
  plate_shirt_size String?  @db.VarChar(10)
  base_shirt_size  String?  @db.VarChar(10)
  cap_size         String?  @db.VarChar(10)
  belt_size        String?  @db.VarChar(10)
  created_at       DateTime @default(now()) @db.DateTime(0)
  updated_at       DateTime @default(now()) @db.DateTime(0)
  users            users    @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_uniform_user")
}

model user_certifications {
  id               BigInt         @id @default(autoincrement()) @db.UnsignedBigInt
  user_id          BigInt         @db.UnsignedBigInt
  certification_id BigInt         @db.UnsignedBigInt
  created_at       DateTime       @default(now()) @db.Timestamp(0)
  certifications   certifications @relation(fields: [certification_id], references: [id], onDelete: Cascade, map: "fk_ucert_cert")
  users            users          @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_ucert_user")

  @@unique([user_id, certification_id], map: "uq_user_cert")
  @@index([certification_id], map: "ix_ucert_cert")
  @@index([user_id], map: "ix_ucert_user")
}

model user_children {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  user_id    BigInt    @db.UnsignedBigInt
  child_name String    @db.VarChar(150)
  birthdate  DateTime? @db.Date
  created_at DateTime  @default(now()) @db.Timestamp(0)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_children_user")

  @@index([user_id], map: "ix_children_user")
}

model user_courses {
  id         BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  user_id    BigInt   @db.UnsignedBigInt
  course_id  BigInt   @db.UnsignedBigInt
  created_at DateTime @default(now()) @db.Timestamp(0)
  courses    courses  @relation(fields: [course_id], references: [id], onDelete: Cascade, map: "fk_uc_course")
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_uc_user")

  @@unique([user_id, course_id], map: "uq_user_course")
  @@index([course_id], map: "ix_uc_course")
  @@index([user_id], map: "ix_uc_user")
}

model user_leagues {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  user_id    BigInt    @db.UnsignedBigInt
  league_id  BigInt    @db.UnsignedBigInt
  started_on DateTime? @db.Date
  ended_on   DateTime? @db.Date
  notes      String?   @db.VarChar(300)
  created_at DateTime  @default(now()) @db.Timestamp(0)
  leagues    leagues   @relation(fields: [league_id], references: [id], onDelete: Cascade, map: "fk_ul_league")
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_ul_user")

  @@unique([user_id, league_id], map: "uq_user_league")
  @@index([league_id], map: "ix_ul_league")
  @@index([user_id], map: "ix_ul_user")
}

model user_vuc_camps {
  id          BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  user_id     BigInt    @db.UnsignedBigInt
  vuc_camp_id BigInt    @db.UnsignedBigInt
  created_at  DateTime  @default(now()) @db.Timestamp(0)
  vuc_camps   vuc_camps @relation(fields: [vuc_camp_id], references: [id], onDelete: Cascade, map: "fk_uvc_camp")
  users       users     @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_uvc_user")

  @@unique([user_id, vuc_camp_id], map: "uq_user_vuc_camp")
  @@index([vuc_camp_id], map: "ix_uvc_camp")
  @@index([user_id], map: "ix_uvc_user")
}

model user_vuc_workshops {
  id              BigInt        @id @default(autoincrement()) @db.UnsignedBigInt
  user_id         BigInt        @db.UnsignedBigInt
  vuc_workshop_id BigInt        @db.UnsignedBigInt
  created_at      DateTime      @default(now()) @db.Timestamp(0)
  users           users         @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_uvws_user")
  vuc_workshops   vuc_workshops @relation(fields: [vuc_workshop_id], references: [id], onDelete: Cascade, map: "fk_uvws_work")

  @@unique([user_id, vuc_workshop_id], map: "uq_user_vuc_workshop")
  @@index([user_id], map: "ix_uvws_user")
  @@index([vuc_workshop_id], map: "ix_uvws_work")
}

model user_workshops {
  id          BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  user_id     BigInt    @db.UnsignedBigInt
  workshop_id BigInt    @db.UnsignedBigInt
  created_at  DateTime  @default(now()) @db.Timestamp(0)
  users       users     @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_uw_user")
  workshops   workshops @relation(fields: [workshop_id], references: [id], onDelete: Cascade, map: "fk_uw_workshop")

  @@unique([user_id, workshop_id], map: "uq_user_workshop")
  @@index([user_id], map: "ix_uw_user")
  @@index([workshop_id], map: "ix_uw_workshop")
}

model users {
  id            BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  role_id       Int      @db.UnsignedTinyInt
  username      String   @db.VarChar(64) @unique(map: "uq_users_username") // recomendado que sea único
  password_hash String   @db.VarChar(255)
  sport_number  Int?     @db.UnsignedTinyInt
  is_active     Boolean  @default(true)
  created_at    DateTime @default(now()) @db.Timestamp(0)
  updated_at    DateTime @default(now()) @db.Timestamp(0)

  medical_profiles   medical_profiles?
  medical_vaccines   medical_vaccines[]
  personal_profiles  personal_profiles?
  uniform_profiles   uniform_profiles?
  user_certifications user_certifications[]
  user_children      user_children[]
  user_courses       user_courses[]
  user_leagues       user_leagues[]
  user_vuc_camps     user_vuc_camps[]
  user_vuc_workshops user_vuc_workshops[]
  user_workshops     user_workshops[]

  roles roles @relation(fields: [role_id], references: [id], map: "fk_users_role")

  @@index([role_id], map: "fk_users_role")
}

model vuc_camps {
  id           BigInt     @id @default(autoincrement()) @db.UnsignedBigInt
  edition      String     @db.VarChar(32)
  start_date   DateTime?  @db.Date
  end_date     DateTime?  @db.Date
  location     String?    @db.VarChar(200)
  system_level Int        @db.UnsignedTinyInt
  created_at   DateTime   @default(now()) @db.Timestamp(0)
  updated_at   DateTime   @default(now()) @db.Timestamp(0)
  user_vuc_camps user_vuc_camps[]

  @@unique([edition, start_date, end_date], map: "uq_vuc_camp")
}

model vuc_workshops {
  id           BigInt       @id @default(autoincrement()) @db.UnsignedBigInt
  name         String       @db.VarChar(255)
  start_date   DateTime?    @db.Date
  end_date     DateTime?    @db.Date
  location     String?      @db.VarChar(200)
  system_level Int          @db.UnsignedTinyInt
  created_at   DateTime     @default(now()) @db.Timestamp(0)
  updated_at   DateTime     @default(now()) @db.Timestamp(0)
  user_vuc_workshops user_vuc_workshops[]

  @@unique([name, start_date, end_date], map: "uq_vuc_workshop")
}

model workshops {
  id             BigInt           @id @default(autoincrement()) @db.UnsignedBigInt
  name           String           @unique(map: "name") @db.VarChar(255)
  created_at     DateTime         @default(now()) @db.Timestamp(0)
  updated_at     DateTime         @default(now()) @db.Timestamp(0)
  user_workshops user_workshops[]
}

enum medical_vaccines_vaccine_code {
  influenza
  covid
  hepatitis
  yellow_fever
}
